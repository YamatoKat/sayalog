---
title: "道の駅旅行計画"
date: 2019-12-16T12:11:48+09:00
draft: false
---


## はじめに

この記事は[SB-AI Advent Calendar 2019](https://adventar.org/calendars/4324)の16日目で、某社でAIやBlockchain関連のスタートアップの技術評価とかしてます。
今回は業務とは一切関係のない私の趣味を紹介させてください。

## 道の駅スタンプラリー知っていますか？
さて、みなさん道の駅スタンプラリーってご存知ですか？
ドライブが趣味で、週末にはいつもどこかを道を走ってます。
東京4年目ともなると、大抵の観光地は走行していて面白みがないなあと感じていた時に、偶然立ち寄った道の駅で、このスタンプラリーブックを発見し制覇することにしました。





## データの準備
まずは、スタンプラリーの本に書いている道の駅の住所をタイプするのはしんどいので、道の駅の住所をググります。

まずは公式の[道路：道の駅案内 - 国土交通省](https://www.mlit.go.jp/road/Michi-no-Eki/list.html)から、XLSファイルをダウンロードしました。
が、下表のように住所や緯度経度が含まれておらず、これでは使えません。

| 県名 	| 駅名 	| 登録回 	| 登録年月 	| 所在地 	| ホームページアドレス 	|
|--------	|--------------------	|--------	|----------	|------------------	|---------------------------------------------------	|
| 北海道 	| 三笠 	| 第1回 	| H5.4 	| 三笠市 	| http://www.hokkaido-michinoeki.jp/michinoeki/172/ 	|
| 北海道 	| スタープラザ　芦別 	| 第1回 	| H5.4 	| 芦別市 	| http://www.hokkaido-michinoeki.jp/michinoeki/202/ 	|
| 北海道 	| 南ふらの 	| 第1回 	| H5.4 	| 空知郡南富良野町 	| http://www.hokkaido-michinoeki.jp/michinoeki/222/ 	|

真面目にやりたい方は、[Places API](https://developers.google.com/places/web-service/intro?hl=ja)を使えば、緯度経度を取得可能です。

めんどくさがり屋なので、ググってますと、[下記の道の駅がプロットされたデータ](https://www.google.com/maps/d/u/0/viewer?mid=1RcagQ4boLskSbkUJXQPPbgANBtY9fTYR&ll=36.493857130316975%2C138.53257361329634&z=8)を発見しました。

<iframe src="https://www.google.com/maps/d/embed?mid=1RcagQ4boLskSbkUJXQPPbgANBtY9fTYR" width="640" height="480"></iframe>

とりあえずKMLをダウンロードし、[CSVに変換](https://tool.stabucky.com/gmap_kml2csv.htm)しました。
２列目が名前で、４列目が経度で、５列目が緯度っぽいです。
面倒なのでこのまま使います。
| 0 	| 茨城1 かつら 	| ﻿id: 8001name: かつらlat: 36.5449685lng: 140.3330587 	| 140.3330587 	| 36.5449685 	| 0 	|
|---	|--------------------	|-----------------------------------------------------------	|-------------	|------------	|---	|
| 1 	| 茨城2 みわ 	| ﻿id: 8002name: みわlat: 36.6558574lng: 140.2800036 	| 140.2800036 	| 36.6558574 	| 0 	|
| 2 	| 茨城3 さとみ 	| ﻿id: 8003name: さとみlat: 36.7057462lng: 140.5096817 	| 140.5096817 	| 36.7057462 	| 0 	|
| 3 	| 茨城4 さかい 	| ﻿id: 8004name: さかいlat: 36.102676lng: 139.795303 	| 139.795303 	| 36.102676 	| 0 	|
| 4 	| 茨城5 奥久慈だいご 	| ﻿id: 8005name: 奥久慈だいごlat: 36.7685851lng: 140.3592347 	| 140.3592347 	| 36.7685851 	| 0 	|



## 巡回セールスマン問題って何？


今回はアルゴリズムとかに特にこだわりないので、[もりとにーのブログ: 巡回セールスマン問題を蟻コロニー最適化と遺伝的アルゴリズムで解いてみる[Python]](https://tony-mooori.blogspot.com/2016/02/tsppython.html)

これをtspari.pyと言う名前で保存してください。


## 実際にやってみよう


```
import pandas as pd 
import matplotlib.pyplot as plt
from pandas.tools import plotting
from sklearn.cluster import KMeans # K-means
from sklearn.decomposition import PCA
import numpy as np
import tspari

#データ読み込み
df = pd.read_csv("michi1206.csv", header=None)

# 何トリップで道の駅を回りたいか
trip = 10
# トリップ数のグループに分割 (メルセンヌツイスターの乱数の種を 10 とする)
kmeans_model = KMeans(n_clusters=trip, random_state=10).fit(df.iloc[:, 3:5])
# 分類結果のラベルを取得
labels = kmeans_model.labels_
# labelsをdfの列に追加
df['label'] = labels

# labelsごとに、TSPする
for t in range(trip):
    temp = df[df['label'] == t]
    name = temp[[1, 3, 4]]
    csv = temp[[3, 4]]
    csv.to_csv('csv_out.csv', index=False)

    # 他の人のコードの仕様上ファイル読み込み
    tsp = TSP(path="csv_out.csv")

    # 蟻コロニー最適化
    tsp.solve(n_agent=1000)

    # GoogleMapで表示しやすいようにソートする
    def func1(lst, value):
        return [i for i, x in enumerate(lst) if x == value]
    newindex = []
    for i in range(len(tsp.result)):
        newindex += func1(tsp.result, i)

    name['newindex'] = newindex
    name_s = name.sort_values('newindex', ascending=True)
    name_s.to_csv('googlemap'+ str(t) + '.csv', index=False)



```



googlemap0.csvからgooglemap9.csvまでのファイルができると思います。
これをあとはマイマップに登録したら終わりです。

### 結果
<iframe src="https://www.google.com/maps/d/u/0/embed?mid=1uD9JAA3C9_FcDfvNkPbtPIJdgyoY3Ksr" width="640" height="480"></iframe>


## まとめ
気が向いたらDwaveとかの量子コンピューターで実装します。
来年のスタンラリー期間に向けて、[Flutter](https://flutter.dev)を使って、アプリにします。
最後までありがとうございました。





